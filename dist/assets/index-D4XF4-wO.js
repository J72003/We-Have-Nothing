var D=Object.defineProperty;var T=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var x=(u,e,t)=>e in u?D(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,L=(u,e)=>{for(var t in e||(e={}))Z.call(e,t)&&x(u,t,e[t]);if(T)for(var t of T(e))R.call(e,t)&&x(u,t,e[t]);return u};var g=(u,e,t)=>x(u,typeof e!="symbol"?e+"":e,t);var E=(u,e,t)=>new Promise((i,a)=>{var s=l=>{try{r(t.next(l))}catch(n){a(n)}},o=l=>{try{r(t.throw(l))}catch(n){a(n)}},r=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,o);r((t=t.apply(u,e)).next())});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const B="go-game-achievements";class ${constructor(){g(this,"achievements",new Map);g(this,"listeners",[]);this.initializeAchievements(),this.loadProgress()}initializeAchievements(){[{id:"first-stone",title:"First Stone",description:"Place your first stone",icon:"ü™®",unlocked:!1},{id:"first-capture",title:"First Blood",description:"Capture your first stone",icon:"‚öîÔ∏è",unlocked:!1},{id:"territory-master",title:"Territory Master",description:"Control 50+ territory points",icon:"üè∞",unlocked:!1},{id:"capture-combo",title:"Combo Master",description:"Capture 10+ stones in one game",icon:"üí•",unlocked:!1},{id:"quick-win",title:"Speed Demon",description:"Win a game in under 50 moves",icon:"‚ö°",unlocked:!1},{id:"patience",title:"Patient Player",description:"Complete a game with 200+ moves",icon:"üßò",unlocked:!1},{id:"corner-master",title:"Corner King",description:"Control all four corners",icon:"üëë",unlocked:!1},{id:"perfect-game",title:"Perfect Victory",description:"Win without losing any stones",icon:"üèÜ",unlocked:!1},{id:"comeback",title:"Comeback Kid",description:"Win after being 30 points behind",icon:"üéØ",unlocked:!1},{id:"beginner",title:"Getting Started",description:"Complete your first game",icon:"üéì",unlocked:!1},{id:"veteran",title:"Veteran Player",description:"Play 10 games",icon:"üéñÔ∏è",unlocked:!1},{id:"master",title:"Go Master",description:"Win 25 games",icon:"ü•á",unlocked:!1}].forEach(t=>this.achievements.set(t.id,t))}loadProgress(){const e=localStorage.getItem(B);if(e)try{const t=JSON.parse(e);Object.keys(t).forEach(i=>{const a=this.achievements.get(i);a&&t[i].unlocked&&(a.unlocked=!0,a.unlockedAt=t[i].unlockedAt)})}catch(t){console.error("Failed to load achievements:",t)}}saveProgress(){const e={};this.achievements.forEach((t,i)=>{e[i]={unlocked:t.unlocked,unlockedAt:t.unlockedAt}}),localStorage.setItem(B,JSON.stringify(e))}unlock(e){const t=this.achievements.get(e);t&&!t.unlocked&&(t.unlocked=!0,t.unlockedAt=Date.now(),this.saveProgress(),this.notifyListeners(t),this.showNotification(t))}showNotification(e){const t=document.createElement("div");t.className="achievement-notification",t.innerHTML=`
      <div class="achievement-icon">${e.icon}</div>
      <div class="achievement-details">
        <div class="achievement-title">Achievement Unlocked!</div>
        <div class="achievement-name">${e.title}</div>
        <div class="achievement-desc">${e.description}</div>
      </div>
    `,document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),300)},4e3)}onUnlock(e){this.listeners.push(e)}notifyListeners(e){this.listeners.forEach(t=>t(e))}getAll(){return Array.from(this.achievements.values())}getUnlocked(){return this.getAll().filter(e=>e.unlocked)}getProgress(){const e=this.getAll(),t=e.filter(i=>i.unlocked).length;return{unlocked:t,total:e.length,percentage:Math.round(t/e.length*100)}}}const v=new $,A={classic:{name:"Classic Wood",boardGradient:{start:"#d7b37d",end:"#c49a6c"},gridColor:"rgba(70,40,10,0.9)",blackStone:"#000",whiteStone:"#fff",backgroundColor:"radial-gradient(circle at center, #e8e3d9, #b6a78a)",territoryAlpha:.25},modern:{name:"Modern Blue",boardGradient:{start:"#4a90e2",end:"#357abd"},gridColor:"rgba(255,255,255,0.8)",blackStone:"#1a1a1a",whiteStone:"#f8f8f8",backgroundColor:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",territoryAlpha:.3},dark:{name:"Dark Mode",boardGradient:{start:"#2c3e50",end:"#1a252f"},gridColor:"rgba(236,240,241,0.6)",blackStone:"#0a0a0a",whiteStone:"#ecf0f1",backgroundColor:"linear-gradient(135deg, #232526 0%, #414345 100%)",territoryAlpha:.35},bamboo:{name:"Bamboo Forest",boardGradient:{start:"#8fbc8f",end:"#6b8e6b"},gridColor:"rgba(34,60,34,0.8)",blackStone:"#1a1a1a",whiteStone:"#fffff0",backgroundColor:"linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)",territoryAlpha:.28}};class N{constructor(){g(this,"currentTheme","classic")}setTheme(e){this.currentTheme=e,this.applyTheme(),localStorage.setItem("go-game-theme",e)}getCurrentTheme(){return this.currentTheme}getThemeConfig(){return A[this.currentTheme]}loadSavedTheme(){const e=localStorage.getItem("go-game-theme");e&&A[e]&&(this.currentTheme=e,this.applyTheme())}applyTheme(){const e=A[this.currentTheme];document.body.style.background=e.backgroundColor}}const P=new N;class G{constructor(){g(this,"canvas");g(this,"ctx");g(this,"gameState");g(this,"BOARD_SIZE",19);g(this,"CELL_SIZE",30);g(this,"STONE_RADIUS",12);g(this,"animationFrame",null);g(this,"audioCtx");g(this,"demoInterval",null);g(this,"mode","PVP");g(this,"hoverPosition",null);g(this,"replayMode",!1);g(this,"replayIndex",0);g(this,"timerInterval",null);g(this,"gamesPlayed",0);g(this,"player1Name","Player 1");g(this,"player2Name","Player 2");g(this,"socket",null);g(this,"roomId",null);this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d");const e=this.CELL_SIZE*(this.BOARD_SIZE+1);this.canvas.width=e,this.canvas.height=e,this.audioCtx=new AudioContext,this.gameState=this.createInitialState(),P.loadSavedTheme(),this.setupEventListeners(),this.animate(),this.updateUI(),this.loadGameStats(),O()}connectToRoom(e){this.roomId=e,this.socket=new WebSocket(`ws://127.0.0.1:8010/ws/${e}`),this.socket.onopen=()=>{console.log(`Connected to room: ${e}`)},this.socket.onmessage=t=>{const i=JSON.parse(t.data);i.type==="move"&&(console.log("Received move:",i),this.placeStone(i.row,i.col))},this.socket.onclose=()=>console.log("Disconnected from room")}createInitialState(){return{board:Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null)),currentPlayer:"black",capturedStones:{black:0,white:0},territoryScore:{black:0,white:0},totalScore:{black:0,white:0},gamePhase:"playing",moveCount:0,consecutivePasses:0,territoryMap:Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null)),captureAnimations:[],lastBoardState:null,koPoint:null,lastMove:null,moveHistory:[],timeControl:{black:6e5,white:6e5},showTerritoryPreview:!1}}setupEventListeners(){var i,a,s,o,r,l,n,h,d,c,m,S,p;(i=document.getElementById("pvpMode"))==null||i.addEventListener("click",()=>{this.mode="PVP",this.newGame()}),(a=document.getElementById("pveMode"))==null||a.addEventListener("click",()=>{this.mode="PVE",this.newGame()}),(s=document.getElementById("aiMode"))==null||s.addEventListener("click",()=>{this.mode="AIAI",this.startDemo()}),(o=document.getElementById("newGame"))==null||o.addEventListener("click",()=>this.newGame()),(r=document.getElementById("pass"))==null||r.addEventListener("click",()=>this.pass()),(l=document.getElementById("startDemo"))==null||l.addEventListener("click",()=>this.startDemo()),(n=document.getElementById("stopDemo"))==null||n.addEventListener("click",()=>this.stopDemo()),(h=document.getElementById("undoMove"))==null||h.addEventListener("click",()=>this.undoMove()),(d=document.getElementById("showHint"))==null||d.addEventListener("click",()=>this.showHint()),(c=document.getElementById("toggleTerritory"))==null||c.addEventListener("click",()=>this.toggleTerritoryPreview()),(m=document.getElementById("replayGame"))==null||m.addEventListener("click",()=>this.startReplay()),(S=document.getElementById("viewAchievements"))==null||S.addEventListener("click",()=>this.showAchievementsModal()),(p=document.getElementById("viewFullLeaderboard"))==null||p.addEventListener("click",()=>_());const e=document.getElementById("boardTheme");e==null||e.addEventListener("change",f=>{const y=f.target.value;P.setTheme(y)});const t=document.getElementById("enableTimer");t==null||t.addEventListener("change",f=>{f.target.checked?this.startTimer():this.stopTimer()}),this.canvas.addEventListener("mousemove",f=>{if(this.replayMode||this.mode==="AIAI"||this.gameState.gamePhase!=="playing"){this.hoverPosition=null;return}if(this.mode==="PVE"&&this.gameState.currentPlayer==="white"){this.hoverPosition=null;return}const y=this.canvas.getBoundingClientRect(),b=f.clientX-y.left,I=f.clientY-y.top,k=Math.round((b-this.CELL_SIZE/2)/this.CELL_SIZE),w=Math.round((I-this.CELL_SIZE/2)/this.CELL_SIZE);this.isValidPosition(w,k)&&this.gameState.board[w][k]===null?this.hoverPosition={row:w,col:k}:this.hoverPosition=null}),this.canvas.addEventListener("mouseleave",()=>{this.hoverPosition=null}),this.canvas.addEventListener("click",f=>{if(this.replayMode||this.mode==="AIAI"||this.gameState.gamePhase!=="playing"||this.mode==="PVE"&&this.gameState.currentPlayer==="white")return;const y=this.canvas.getBoundingClientRect(),b=f.clientX-y.left,I=f.clientY-y.top,k=Math.round((b-this.CELL_SIZE/2)/this.CELL_SIZE),w=Math.round((I-this.CELL_SIZE/2)/this.CELL_SIZE);this.isValidPosition(w,k)&&this.placeStone(w,k)})}placeStone(e,t){if(this.gameState.gamePhase!=="playing"&&this.gameState.gamePhase!=="demo"||!this.isValidPosition(e,t)||this.gameState.board[e][t]!==null||this.gameState.koPoint&&this.gameState.koPoint.row===e&&this.gameState.koPoint.col===t)return;const i=JSON.stringify(this.gameState.board);this.gameState.board[e][t]=this.gameState.currentPlayer;const a=this.handleCaptures(e,t);if(!this.hasLibertyCheck(e,t)){this.gameState.board[e][t]=null;return}const s=JSON.stringify(this.gameState.board);if(a===1&&s===this.gameState.lastBoardState){this.gameState.board[e][t]=null;return}this.gameState.lastBoardState=i,this.gameState.koPoint=null,this.gameState.moveHistory.push({row:e,col:t,player:this.gameState.currentPlayer,timestamp:Date.now(),boardState:i,capturedStones:L({},this.gameState.capturedStones)}),this.gameState.lastMove={row:e,col:t},this.playSound(600),this.gameState.moveCount++,this.gameState.consecutivePasses=0,this.checkAchievements(),this.updateScores(),this.checkGameOver(),this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({type:"move",row:e,col:t,color:this.gameState.currentPlayer})),this.switchPlayer(),this.updateUI(),this.mode==="PVE"&&this.gameState.currentPlayer==="white"&&this.gameState.gamePhase==="playing"&&setTimeout(()=>this.aiMove(),300)}undoMove(){if(!(this.gameState.moveHistory.length===0||this.gameState.gamePhase!=="playing"||this.mode==="PVE"&&this.gameState.currentPlayer==="white"||!this.gameState.moveHistory.pop())){if(this.mode==="PVE"&&this.gameState.moveHistory.length>0&&this.gameState.moveHistory.pop(),this.gameState.moveHistory.length>0){const t=this.gameState.moveHistory[this.gameState.moveHistory.length-1];this.gameState.board=JSON.parse(t.boardState),this.gameState.capturedStones=L({},t.capturedStones),this.gameState.currentPlayer=t.player==="black"?"white":"black",this.gameState.lastMove={row:t.row,col:t.col}}else this.gameState=this.createInitialState();this.gameState.moveCount=this.gameState.moveHistory.length,this.updateScores(),this.updateUI()}}showHint(){if(this.gameState.gamePhase!=="playing"||this.mode==="AIAI")return;const e=[];for(let a=0;a<this.BOARD_SIZE;a++)for(let s=0;s<this.BOARD_SIZE;s++)this.gameState.board[a][s]===null&&this.canPlaceStone(a,s)&&e.push([a,s]);if(e.length===0)return;let t=null,i=-1/0;for(const[a,s]of e){const o=this.evaluateMove(a,s);o>i&&(i=o,t=[a,s])}t&&this.highlightHint(t[0],t[1])}evaluateMove(e,t){let i=0;const a=[[1,0],[-1,0],[0,1],[0,-1]];for(const[r,l]of a){const n=e+r,h=t+l;if(this.isValidPosition(n,h)){const d=this.gameState.board[n][h];d===this.gameState.currentPlayer?i+=2:d!==null&&(i+=1)}}const s=e===0||e===this.BOARD_SIZE-1||t===0||t===this.BOARD_SIZE-1?-3:0,o=Math.abs(e-this.BOARD_SIZE/2)<3&&Math.abs(t-this.BOARD_SIZE/2)<3?5:0;return i+=s+o,i+=Math.random()*2,i}highlightHint(e,t){const i=(t+.5)*this.CELL_SIZE,a=(e+.5)*this.CELL_SIZE;let s=.8;const o=()=>{s-=.02,s>0&&requestAnimationFrame(o)},r=this.draw.bind(this);this.draw=()=>{r(),s>0?(this.ctx.globalAlpha=s,this.ctx.beginPath(),this.ctx.arc(i,a,this.STONE_RADIUS+4,0,2*Math.PI),this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.globalAlpha=1):this.draw=r},o()}toggleTerritoryPreview(){this.gameState.showTerritoryPreview=!this.gameState.showTerritoryPreview,this.updateUI()}hasLibertyCheck(e,t){const i=[[1,0],[-1,0],[0,1],[0,-1]],a=new Set,s=this.gameState.board[e][t],o=(r,l)=>{if(!this.isValidPosition(r,l))return!1;const n=`${r},${l}`;if(a.has(n))return!1;a.add(n);const h=this.gameState.board[r][l];if(h===null)return!0;if(h!==s)return!1;for(const[d,c]of i)if(o(r+d,l+c))return!0;return!1};return o(e,t)}handleCaptures(e,t){const i=this.gameState.currentPlayer==="black"?"white":"black",a=[[1,0],[-1,0],[0,1],[0,-1]],s=[],o=(n,h,d=new Set)=>{if(!this.isValidPosition(n,h))return!1;const c=`${n},${h}`;if(d.has(c))return!1;d.add(c);const m=this.gameState.board[n][h];if(m===null)return!0;if(m!==i)return!1;for(const[S,p]of a){const f=n+S,y=h+p;if(o(f,y,d))return!0}return!1},r=(n,h,d=new Set,c=[])=>{if(!this.isValidPosition(n,h))return c;const m=`${n},${h}`;if(d.has(m)||(d.add(m),this.gameState.board[n][h]!==i))return c;c.push([n,h]);for(const[S,p]of a)r(n+S,h+p,d,c);return c};for(const[n,h]of a){const d=e+n,c=t+h;if(this.isValidPosition(d,c)&&this.gameState.board[d][c]===i){const m=r(d,c);o(d,c,new Set)||s.push(...m)}}const l=s.length;if(l>0){const n=performance.now();for(const[h,d]of s)this.gameState.board[h][d]=null,this.gameState.captureAnimations.push({row:h,col:d,startTime:n});this.gameState.capturedStones[this.gameState.currentPlayer]+=l}return l}pass(){if(this.gameState.gamePhase==="playing"){if(this.gameState.consecutivePasses++,this.switchPlayer(),this.updateUI(),this.gameState.consecutivePasses>=2){this.endGame("Both players passed.");return}this.mode==="PVE"&&this.gameState.currentPlayer==="white"&&this.gameState.gamePhase==="playing"&&setTimeout(()=>this.aiMove(),300)}}startReplay(){if(this.gameState.moveHistory.length===0){alert("No moves to replay!");return}this.replayMode=!0,this.replayIndex=0,this.gameState=this.createInitialState(),this.gameState.gamePhase="finished";const e=setInterval(()=>{if(this.replayIndex>=this.gameState.moveHistory.length){clearInterval(e),this.replayMode=!1;return}const t=this.gameState.moveHistory[this.replayIndex];this.gameState.board[t.row][t.col]=t.player,this.gameState.lastMove={row:t.row,col:t.col},this.replayIndex++,this.updateUI()},500)}startTimer(){if(this.timerInterval)return;const e=Date.now();this.timerInterval=window.setInterval(()=>{if(this.gameState.gamePhase!=="playing"){this.stopTimer();return}const t=Date.now()-e,i=this.gameState.currentPlayer;this.gameState.timeControl&&(this.gameState.timeControl[i]=Math.max(0,6e5-t),this.gameState.timeControl[i]<=0&&this.endGame(`${i} ran out of time!`),this.updateUI())},100)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}checkAchievements(){this.gameState.moveCount===1&&v.unlock("first-stone"),this.gameState.capturedStones.black+this.gameState.capturedStones.white>0&&v.unlock("first-capture"),this.gameState.capturedStones[this.gameState.currentPlayer]>=10&&v.unlock("capture-combo"),this.gameState.territoryScore[this.gameState.currentPlayer]>=50&&v.unlock("territory-master"),this.gameState.moveCount>=200&&v.unlock("patience")}checkGameEndAchievements(e){e!=="draw"&&(this.gamesPlayed++,localStorage.setItem("go-games-played",this.gamesPlayed.toString()),this.gamesPlayed===1&&v.unlock("beginner"),this.gamesPlayed===10&&v.unlock("veteran"),this.gameState.moveCount<50&&v.unlock("quick-win"),this.gameState.capturedStones[e]===0&&v.unlock("perfect-game"),[[0,0],[0,this.BOARD_SIZE-1],[this.BOARD_SIZE-1,0],[this.BOARD_SIZE-1,this.BOARD_SIZE-1]].every(([s,o])=>this.gameState.board[s][o]===e)&&v.unlock("corner-master"))}loadGameStats(){const e=localStorage.getItem("go-games-played");this.gamesPlayed=e?parseInt(e):0}showAchievementsModal(){const e=v.getAll(),t=v.getProgress();let i=document.getElementById("achievementsModal");i||(i=document.createElement("div"),i.id="achievementsModal",i.className="modal-overlay",document.body.appendChild(i)),i.innerHTML=`
      <div class="modal-content achievements-modal">
        <h2>Achievements</h2>
        <div class="achievement-progress">
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${t.percentage}%"></div>
          </div>
          <div class="progress-text">${t.unlocked} / ${t.total} (${t.percentage}%)</div>
        </div>
        <div class="achievements-grid">
          ${e.map(a=>`
            <div class="achievement-card ${a.unlocked?"unlocked":"locked"}">
              <div class="achievement-icon">${a.icon}</div>
              <div class="achievement-info">
                <div class="achievement-title">${a.title}</div>
                <div class="achievement-description">${a.description}</div>
                ${a.unlocked&&a.unlockedAt?`
                  <div class="achievement-unlocked-date">
                    Unlocked: ${new Date(a.unlockedAt).toLocaleDateString()}
                  </div>
                `:""}
              </div>
            </div>
          `).join("")}
        </div>
        <button class="btn btn-primary" onclick="document.getElementById('achievementsModal').remove()">Close</button>
      </div>
    `,i.style.display="flex",i.onclick=a=>{a.target===i&&i.remove()}}aiMove(){if(this.gameState.gamePhase!=="playing"&&this.gameState.gamePhase!=="demo")return;const e=[];for(let a=0;a<this.BOARD_SIZE;a++)for(let s=0;s<this.BOARD_SIZE;s++)this.gameState.board[a][s]===null&&this.canPlaceStone(a,s)&&e.push([a,s]);if(e.length===0){this.pass();return}let t=null,i=-1/0;for(const[a,s]of e){const o=this.evaluateMove(a,s);o>i&&(i=o,t=[a,s])}if(t){const[a,s]=t;this.placeStone(a,s)}else this.pass()}canPlaceStone(e,t){if(!this.isValidPosition(e,t)||this.gameState.board[e][t]!==null||this.gameState.koPoint&&this.gameState.koPoint.row===e&&this.gameState.koPoint.col===t)return!1;const i=this.gameState.board.map(o=>[...o]),a=this.gameState.currentPlayer;this.gameState.board[e][t]=a,this.handleCaptures(e,t);const s=this.hasLibertyCheck(e,t);return this.gameState.board=i,s}startDemo(){if(this.demoInterval)return;this.mode="AIAI",this.gameState=this.createInitialState(),this.gameState.gamePhase="demo";const e=document.getElementById("gameOverDisplay");e&&(e.style.display="none"),this.demoInterval=window.setInterval(()=>{this.gameState.gamePhase==="demo"&&(this.aiMove(),this.updateScores(),this.updateUI()),(this.gameState.moveCount>=150||this.gameState.gamePhase==="finished")&&this.stopDemo()},100)}stopDemo(){return E(this,null,function*(){this.demoInterval&&clearInterval(this.demoInterval),this.demoInterval=null,this.endGame("AI demo ended")})}endGame(e){return E(this,null,function*(){if(this.gameState.gamePhase==="finished")return;this.gameState.gamePhase="finished",this.stopTimer(),this.updateScores();const t=this.gameState.totalScore.black,i=this.gameState.totalScore.white,a=this.gameState.territoryScore.black,s=this.gameState.territoryScore.white,o=t+a,r=i+s;let l="draw";o>r?l="black":r>o&&(l="white"),this.checkGameEndAchievements(l);let n="";o>r?n=`${this.player1Name} (Black) wins!`:r>o?n=`${this.player2Name} (White) wins!`:n="It's a draw!";const h=document.getElementById("gameOverDisplay"),d=document.getElementById("gameOverReason"),c=document.getElementById("gameOverScores"),m=document.getElementById("gameOverWinner");h&&(h.style.display="block"),d&&(d.textContent=e),c&&(c.innerHTML=`
        <div style="margin-bottom: 8px;">
          <strong>‚ö´ ${this.player1Name} (Black)</strong><br>
          Stones: ${t} | Territory: ${a} | Total: ${o}
        </div>
        <div>
          <strong>‚ö™ ${this.player2Name} (White)</strong><br>
          Stones: ${i} | Territory: ${s} | Total: ${r}
        </div>
      `),m&&(m.textContent=n);const S=this.mode==="AIAI"?"BlackAI":this.player1Name,p=this.mode==="AIAI"?"WhiteAI":this.player2Name;yield M(S),yield M(p),yield H(S,p,o,r),yield O()})}checkGameOver(){this.gameState.board.every(t=>t.every(i=>i!==null))&&this.endGame("Board filled up")}updateScores(){const e=this.gameState.board.flat().filter(o=>o==="black").length,t=this.gameState.board.flat().filter(o=>o==="white").length;this.gameState.totalScore.black=e,this.gameState.totalScore.white=t;const{black:i,white:a,map:s}=this.calculateTerritory();this.gameState.territoryScore.black=i,this.gameState.territoryScore.white=a,this.gameState.territoryMap=s}calculateTerritory(){const e=new Set,t=Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null));let i=0,a=0;const s=[[1,0],[-1,0],[0,1],[0,-1]],o=(r,l)=>{const n=[[r,l]],h=[],d=new Set;for(;n.length;){const[c,m]=n.pop(),S=`${c},${m}`;if(!e.has(S)){e.add(S),h.push([c,m]);for(const[p,f]of s){const y=c+p,b=m+f;if(!this.isValidPosition(y,b))continue;const I=this.gameState.board[y][b];I===null?n.push([y,b]):d.add(I)}}}if(d.size===1){const c=Array.from(d)[0];for(const[m,S]of h)t[m][S]=c;c==="black"?i+=h.length:a+=h.length}else for(const[c,m]of h)t[c][m]="neutral"};for(let r=0;r<this.BOARD_SIZE;r++)for(let l=0;l<this.BOARD_SIZE;l++)this.gameState.board[r][l]===null&&!e.has(`${r},${l}`)&&o(r,l);return{black:i,white:a,map:t}}newGame(){this.gameState=this.createInitialState();const e=document.getElementById("gameOverDisplay");e&&(e.style.display="none"),this.updateUI()}switchPlayer(){this.gameState.currentPlayer=this.gameState.currentPlayer==="black"?"white":"black"}isValidPosition(e,t){return e>=0&&e<this.BOARD_SIZE&&t>=0&&t<this.BOARD_SIZE}animate(){this.draw(),this.animationFrame=requestAnimationFrame(()=>this.animate())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(),(this.gameState.showTerritoryPreview||this.gameState.gamePhase==="finished")&&this.drawTerritoryOverlay(),this.drawStones(),this.drawLastMoveMarker(),this.drawHoverPreview()}drawBoard(){const e=P.getThemeConfig(),t=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);t.addColorStop(0,e.boardGradient.start),t.addColorStop(1,e.boardGradient.end),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle=e.gridColor;for(let a=0;a<this.BOARD_SIZE;a++){const s=(a+.5)*this.CELL_SIZE;this.ctx.beginPath(),this.ctx.moveTo(s,this.CELL_SIZE/2),this.ctx.lineTo(s,this.canvas.height-this.CELL_SIZE/2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.CELL_SIZE/2,s),this.ctx.lineTo(this.canvas.width-this.CELL_SIZE/2,s),this.ctx.stroke()}const i=this.getStarPoints();this.ctx.fillStyle=e.gridColor;for(const[a,s]of i){const o=(s+.5)*this.CELL_SIZE,r=(a+.5)*this.CELL_SIZE;this.ctx.beginPath(),this.ctx.arc(o,r,3,0,2*Math.PI),this.ctx.fill()}}getStarPoints(){return this.BOARD_SIZE===19?[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]:this.BOARD_SIZE===13?[[3,3],[3,9],[6,6],[9,3],[9,9]]:this.BOARD_SIZE===9?[[2,2],[2,6],[4,4],[6,2],[6,6]]:[]}drawTerritoryOverlay(){const e=P.getThemeConfig();for(let t=0;t<this.BOARD_SIZE;t++)for(let i=0;i<this.BOARD_SIZE;i++){const a=this.gameState.territoryMap[t][i];if(a&&a!=="neutral"){const s=(i+.5)*this.CELL_SIZE,o=(t+.5)*this.CELL_SIZE;this.ctx.globalAlpha=e.territoryAlpha,this.ctx.beginPath(),this.ctx.arc(s,o,6,0,2*Math.PI),this.ctx.fillStyle=a==="black"?e.blackStone:e.whiteStone,this.ctx.fill(),this.ctx.globalAlpha=1}}}drawLastMoveMarker(){if(!this.gameState.lastMove)return;const{row:e,col:t}=this.gameState.lastMove,i=(t+.5)*this.CELL_SIZE,a=(e+.5)*this.CELL_SIZE;this.ctx.strokeStyle="#FF4444",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(i,a,this.STONE_RADIUS+3,0,2*Math.PI),this.ctx.stroke()}drawHoverPreview(){if(!this.hoverPosition)return;const{row:e,col:t}=this.hoverPosition,i=(t+.5)*this.CELL_SIZE,a=(e+.5)*this.CELL_SIZE,s=P.getThemeConfig();this.ctx.globalAlpha=.4,this.ctx.beginPath(),this.ctx.arc(i,a,this.STONE_RADIUS,0,2*Math.PI),this.ctx.fillStyle=this.gameState.currentPlayer==="black"?s.blackStone:s.whiteStone,this.ctx.fill(),this.ctx.globalAlpha=1}drawStones(){const e=performance.now(),t=300,i=P.getThemeConfig();for(let a=0;a<this.BOARD_SIZE;a++)for(let s=0;s<this.BOARD_SIZE;s++){const o=this.gameState.board[a][s];if(!o)continue;const r=(s+.5)*this.CELL_SIZE,l=(a+.5)*this.CELL_SIZE;this.ctx.beginPath(),this.ctx.arc(r,l,this.STONE_RADIUS,0,2*Math.PI),this.ctx.fillStyle=o==="black"?i.blackStone:i.whiteStone,this.ctx.fill(),o==="white"&&(this.ctx.strokeStyle="rgba(0,0,0,0.2)",this.ctx.lineWidth=1,this.ctx.stroke());const n=this.ctx.createRadialGradient(r-this.STONE_RADIUS*.3,l-this.STONE_RADIUS*.3,0,r,l,this.STONE_RADIUS);o==="black"?(n.addColorStop(0,"rgba(100,100,100,0.3)"),n.addColorStop(1,"rgba(0,0,0,0)")):(n.addColorStop(0,"rgba(255,255,255,0.8)"),n.addColorStop(1,"rgba(255,255,255,0)")),this.ctx.fillStyle=n,this.ctx.fill()}this.gameState.captureAnimations=this.gameState.captureAnimations.filter(a=>{const s=e-a.startTime;if(s>t)return!1;const o=s/t,r=(a.col+.5)*this.CELL_SIZE,l=(a.row+.5)*this.CELL_SIZE,n=1-o,h=this.STONE_RADIUS*(1+o*.5),c=this.gameState.capturedStones.black>this.gameState.capturedStones.white?i.blackStone:i.whiteStone;return this.ctx.globalAlpha=n,this.ctx.beginPath(),this.ctx.arc(r,l,h,0,2*Math.PI),this.ctx.fillStyle=c,this.ctx.fill(),this.ctx.globalAlpha=1,!0})}updateUI(){const e=document.getElementById("currentPlayer"),t=document.getElementById("moveCount"),i=document.getElementById("historyCount");e&&(e.textContent=this.gameState.currentPlayer==="black"?"Black":"White"),t&&(t.textContent=this.gameState.moveCount.toString()),i&&(i.textContent=this.gameState.moveHistory.length.toString());const a=document.getElementById("blackCaptured"),s=document.getElementById("whiteCaptured"),o=document.getElementById("blackTerritory"),r=document.getElementById("whiteTerritory"),l=document.getElementById("blackTotal"),n=document.getElementById("whiteTotal");a&&(a.textContent=this.gameState.capturedStones.black.toString()),s&&(s.textContent=this.gameState.capturedStones.white.toString()),o&&(o.textContent=this.gameState.territoryScore.black.toString()),r&&(r.textContent=this.gameState.territoryScore.white.toString());const h=this.gameState.totalScore.black+this.gameState.territoryScore.black,d=this.gameState.totalScore.white+this.gameState.territoryScore.white;l&&(l.textContent=h.toString()),n&&(n.textContent=d.toString());const c=document.getElementById("timerDisplay"),m=document.getElementById("enableTimer");if(c&&(m!=null&&m.checked)&&this.gameState.timeControl){c.style.display="block";const S=document.getElementById("blackTimer"),p=document.getElementById("whiteTimer");if(S){const f=Math.floor(this.gameState.timeControl.black/6e4),y=Math.floor(this.gameState.timeControl.black%6e4/1e3);S.textContent=`${f}:${y.toString().padStart(2,"0")}`}if(p){const f=Math.floor(this.gameState.timeControl.white/6e4),y=Math.floor(this.gameState.timeControl.white%6e4/1e3);p.textContent=`${f}:${y.toString().padStart(2,"0")}`}}else c&&(c.style.display="none")}playSound(e){const t=this.audioCtx.createOscillator(),i=this.audioCtx.createGain();t.type="sine",t.frequency.value=e,i.gain.setValueAtTime(.05,this.audioCtx.currentTime),t.connect(i).connect(this.audioCtx.destination),t.start(),t.stop(this.audioCtx.currentTime+.1)}}const C="http://127.0.0.1:8010";function M(u){return E(this,null,function*(){yield fetch(`${C}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u})})})}function H(u,e,t,i){return E(this,null,function*(){yield fetch(`${C}/games`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({player1:u,player2:e,score_p1:t,score_p2:i})})})}function O(){return E(this,null,function*(){var a;const t=(yield(yield fetch(`${C}/leaderboard`)).json()).filter(s=>s.wins>0&&!["Player 1","Player 2","TestPlayer","Default","test"].includes(s.name)).sort((s,o)=>o.wins-s.wins).slice(0,10),i=document.getElementById("leaderboard");i&&(i.innerHTML=`
    <h3>üèÜ Leaderboard (Top 10)</h3>
    <table>
      <tr><th>Player</th><th>Wins</th></tr>
      ${t.map(s=>`<tr><td>${s.name}</td><td>${s.wins}</td></tr>`).join("")}
    </table>
    <button id="viewFullLeaderboard" class="btn btn-secondary" style="margin-top:8px;">
      View Full Leaderboard
    </button>
  `,(a=document.getElementById("viewFullLeaderboard"))==null||a.addEventListener("click",()=>_()))})}function _(){return E(this,null,function*(){var a;const t=(yield(yield fetch(`${C}/leaderboard`)).json()).filter(s=>!["Player 1","Player 2","TestPlayer","Default","test"].includes(s.name)).sort((s,o)=>o.wins-s.wins);let i=document.getElementById("leaderboardModal");i||(i=document.createElement("div"),i.id="leaderboardModal",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.background="rgba(0,0,0,0.6)",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.zIndex="9999",i.innerHTML=`
      <div style="
        background: #f8f5ef;
        padding: 20px;
        border-radius: 12px;
        width: 350px;
        max-height: 500px;
        overflow-y: auto;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      ">
        <h2 style="text-align:center;">üèÜ Full Leaderboard</h2>
        <table style="width:100%; border-collapse:collapse;">
          <tr style="background:#e0d5c0;"><th>Player</th><th>Wins</th></tr>
          ${t.map(s=>`<tr><td style="padding:6px;">${s.name}</td><td style="text-align:right;">${s.wins}</td></tr>`).join("")}
        </table>
        <div style="text-align:center; margin-top:12px;">
          <button id="closeLeaderboardModal" class="btn btn-primary">Close</button>
        </div>
      </div>
    `,document.body.appendChild(i)),(a=document.getElementById("closeLeaderboardModal"))==null||a.addEventListener("click",()=>i==null?void 0:i.remove())})}document.addEventListener("DOMContentLoaded",()=>new G);
