var x=Object.defineProperty;var L=(u,a,e)=>a in u?x(u,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[a]=e;var S=(u,a,e)=>L(u,typeof a!="symbol"?a+"":a,e);var g=(u,a,e)=>new Promise((t,s)=>{var i=n=>{try{c(e.next(n))}catch(r){s(r)}},o=n=>{try{c(e.throw(n))}catch(r){s(r)}},c=n=>n.done?t(n.value):Promise.resolve(n.value).then(i,o);c((e=e.apply(u,a)).next())});(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class B{constructor(){S(this,"canvas");S(this,"ctx");S(this,"gameState");S(this,"BOARD_SIZE",19);S(this,"CELL_SIZE",30);S(this,"STONE_RADIUS",12);S(this,"animationFrame",null);S(this,"audioCtx");S(this,"demoInterval",null);S(this,"mode","PVP");S(this,"player1Name","Player 1");S(this,"player2Name","Player 2");S(this,"socket",null);S(this,"roomId",null);this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d");const a=this.CELL_SIZE*(this.BOARD_SIZE+1);this.canvas.width=a,this.canvas.height=a,this.audioCtx=new AudioContext,this.gameState=this.createInitialState(),this.setupEventListeners(),this.animate(),this.updateUI(),k()}connectToRoom(a){this.roomId=a,this.socket=new WebSocket(`ws://127.0.0.1:8010/ws/${a}`),this.socket.onopen=()=>{console.log(`Connected to room: ${a}`)},this.socket.onmessage=e=>{const t=JSON.parse(e.data);t.type==="move"&&(console.log("Received move:",t),this.placeStone(t.row,t.col))},this.socket.onclose=()=>console.log("Disconnected from room")}createInitialState(){return{board:Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null)),currentPlayer:"black",capturedStones:{black:0,white:0},territoryScore:{black:0,white:0},totalScore:{black:0,white:0},gamePhase:"playing",moveCount:0,consecutivePasses:0,territoryMap:Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null)),captureAnimations:[],lastBoardState:null,koPoint:null}}setupEventListeners(){var a,e,t,s,i,o,c;(a=document.getElementById("pvpMode"))==null||a.addEventListener("click",()=>{this.mode="PVP",this.newGame()}),(e=document.getElementById("pveMode"))==null||e.addEventListener("click",()=>{this.mode="PVE",this.newGame()}),(t=document.getElementById("aiMode"))==null||t.addEventListener("click",()=>{this.mode="AIAI",this.startDemo()}),(s=document.getElementById("newGame"))==null||s.addEventListener("click",()=>this.newGame()),(i=document.getElementById("pass"))==null||i.addEventListener("click",()=>this.pass()),(o=document.getElementById("stopDemo"))==null||o.addEventListener("click",()=>this.stopDemo()),(c=document.getElementById("viewFullLeaderboard"))==null||c.addEventListener("click",()=>P()),this.canvas.addEventListener("click",n=>{if(this.mode==="AIAI"||this.gameState.gamePhase!=="playing")return;const r=this.canvas.getBoundingClientRect(),l=n.clientX-r.left,d=n.clientY-r.top,h=Math.round((l-this.CELL_SIZE/2)/this.CELL_SIZE),m=Math.round((d-this.CELL_SIZE/2)/this.CELL_SIZE);this.isValidPosition(m,h)&&(this.placeStone(m,h),this.mode==="PVE"&&this.gameState.currentPlayer==="white"&&setTimeout(()=>this.aiMove(),150))})}placeStone(a,e){if(!this.isValidPosition(a,e)||this.gameState.board[a][e]!==null||this.gameState.koPoint&&this.gameState.koPoint.row===a&&this.gameState.koPoint.col===e)return;const t=JSON.stringify(this.gameState.board);this.gameState.board[a][e]=this.gameState.currentPlayer;const s=this.handleCaptures(a,e);if(!this.hasLibertyCheck(a,e)){this.gameState.board[a][e]=null;return}const i=JSON.stringify(this.gameState.board);if(s===1&&i===this.gameState.lastBoardState){this.gameState.board[a][e]=null;return}this.gameState.lastBoardState=t,this.gameState.koPoint=null,this.playSound(600),this.gameState.moveCount++,this.gameState.consecutivePasses=0,this.updateScores(),this.checkGameOver(),this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({type:"move",row:a,col:e,color:this.gameState.currentPlayer})),this.switchPlayer(),this.updateUI()}hasLibertyCheck(a,e){const t=[[1,0],[-1,0],[0,1],[0,-1]],s=new Set,i=this.gameState.board[a][e],o=(c,n)=>{if(!this.isValidPosition(c,n))return!1;const r=`${c},${n}`;if(s.has(r))return!1;s.add(r);const l=this.gameState.board[c][n];if(l===null)return!0;if(l!==i)return!1;for(const[d,h]of t)if(o(c+d,n+h))return!0;return!1};return o(a,e)}handleCaptures(a,e){const t=this.gameState.currentPlayer==="black"?"white":"black",s=[[1,0],[-1,0],[0,1],[0,-1]],i=[],o=(r,l,d=new Set)=>{if(!this.isValidPosition(r,l))return!1;const h=`${r},${l}`;if(d.has(h))return!1;d.add(h);const m=this.gameState.board[r][l];if(m===null)return!0;if(m!==t)return!1;for(const[f,y]of s){const E=r+f,p=l+y;if(o(E,p,d))return!0}return!1},c=(r,l,d=new Set,h=[])=>{if(!this.isValidPosition(r,l))return h;const m=`${r},${l}`;if(d.has(m)||(d.add(m),this.gameState.board[r][l]!==t))return h;h.push([r,l]);for(const[f,y]of s)c(r+f,l+y,d,h);return h};for(const[r,l]of s){const d=a+r,h=e+l;if(this.isValidPosition(d,h)&&this.gameState.board[d][h]===t){const m=c(d,h);o(d,h,new Set)||i.push(...m)}}const n=i.length;if(n>0){const r=performance.now();for(const[l,d]of i)this.gameState.board[l][d]=null,this.gameState.captureAnimations.push({row:l,col:d,startTime:r});this.gameState.capturedStones[this.gameState.currentPlayer]+=n}return n}pass(){if(this.gameState.consecutivePasses++,this.switchPlayer(),this.updateUI(),this.gameState.consecutivePasses>=2){this.endGame("Both players passed.");return}this.mode==="PVE"&&this.gameState.currentPlayer==="white"&&setTimeout(()=>this.aiMove(),150)}aiMove(){const a=[];for(let s=0;s<this.BOARD_SIZE;s++)for(let i=0;i<this.BOARD_SIZE;i++)this.gameState.board[s][i]===null&&a.push([s,i]);if(a.length===0){this.pass();return}let e=null,t=-1/0;for(const[s,i]of a){const o=this.evaluateMove(s,i);o>t&&(t=o,e=[s,i])}if(e){const[s,i]=e;this.placeStone(s,i)}else this.pass()}evaluateMove(a,e){let t=0;const s=[[1,0],[-1,0],[0,1],[0,-1]];for(const[c,n]of s){const r=a+c,l=e+n;if(this.isValidPosition(r,l)){const d=this.gameState.board[r][l];d===this.gameState.currentPlayer?t+=2:d!==null&&(t+=1)}}const i=a===0||a===this.BOARD_SIZE-1||e===0||e===this.BOARD_SIZE-1?-3:0,o=Math.abs(a-this.BOARD_SIZE/2)<3&&Math.abs(e-this.BOARD_SIZE/2)<3?5:0;return t+=i+o,t+=Math.random()*2,t}startDemo(){this.demoInterval||(this.mode="AIAI",this.gameState.gamePhase="demo",this.demoInterval=window.setInterval(()=>{this.aiMove(),this.updateScores(),this.updateUI(),this.gameState.moveCount>=150&&this.stopDemo()},100))}stopDemo(){return g(this,null,function*(){this.demoInterval&&clearInterval(this.demoInterval),this.demoInterval=null,this.endGame("AI demo ended")})}endGame(a){return g(this,null,function*(){if(this.gameState.gamePhase==="finished")return;this.gameState.gamePhase="finished",this.updateScores();const e=this.gameState.totalScore.black,t=this.gameState.totalScore.white,s=this.gameState.territoryScore.black,i=this.gameState.territoryScore.white,o=e+s,c=t+i;let n="";o>c?n=`üèÜ ${this.player1Name} (Black) wins!`:c>o?n=`üèÜ ${this.player2Name} (White) wins!`:n="ü§ù It's a draw!",alert(`
üéÆ Game Over: ${a}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ö´ ${this.player1Name} (Black)
Stones: ${e}
Territory: ${s}
Total: ${o}

‚ö™ ${this.player2Name} (White)
Stones: ${t}
Territory: ${i}
Total: ${c}

${n}
`);const r=this.mode==="AIAI"?"BlackAI":this.player1Name,l=this.mode==="AIAI"?"WhiteAI":this.player2Name;yield v(r),yield v(l),yield C(r,l,o,c),yield k()})}checkGameOver(){this.gameState.board.every(e=>e.every(t=>t!==null))&&this.endGame("Board filled up")}updateScores(){const a=this.gameState.board.flat().filter(o=>o==="black").length,e=this.gameState.board.flat().filter(o=>o==="white").length;this.gameState.totalScore.black=a,this.gameState.totalScore.white=e;const{black:t,white:s,map:i}=this.calculateTerritory();this.gameState.territoryScore.black=t,this.gameState.territoryScore.white=s,this.gameState.territoryMap=i}calculateTerritory(){const a=new Set,e=Array(this.BOARD_SIZE).fill(null).map(()=>Array(this.BOARD_SIZE).fill(null));let t=0,s=0;const i=[[1,0],[-1,0],[0,1],[0,-1]],o=(c,n)=>{const r=[[c,n]],l=[],d=new Set;for(;r.length;){const[h,m]=r.pop(),f=`${h},${m}`;if(!a.has(f)){a.add(f),l.push([h,m]);for(const[y,E]of i){const p=h+y,w=m+E;if(!this.isValidPosition(p,w))continue;const I=this.gameState.board[p][w];I===null?r.push([p,w]):d.add(I)}}}if(d.size===1){const h=Array.from(d)[0];for(const[m,f]of l)e[m][f]=h;h==="black"?t+=l.length:s+=l.length}else for(const[h,m]of l)e[h][m]="neutral"};for(let c=0;c<this.BOARD_SIZE;c++)for(let n=0;n<this.BOARD_SIZE;n++)this.gameState.board[c][n]===null&&!a.has(`${c},${n}`)&&o(c,n);return{black:t,white:s,map:e}}newGame(){this.gameState=this.createInitialState(),this.updateUI()}switchPlayer(){this.gameState.currentPlayer=this.gameState.currentPlayer==="black"?"white":"black"}isValidPosition(a,e){return a>=0&&a<this.BOARD_SIZE&&e>=0&&e<this.BOARD_SIZE}animate(){this.draw(),this.animationFrame=requestAnimationFrame(()=>this.animate())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(),this.drawTerritoryOverlay(),this.drawStones()}drawBoard(){const a=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);a.addColorStop(0,"#d7b37d"),a.addColorStop(1,"#c49a6c"),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="rgba(70,40,10,0.9)";for(let e=0;e<this.BOARD_SIZE;e++){const t=(e+.5)*this.CELL_SIZE;this.ctx.beginPath(),this.ctx.moveTo(t,this.CELL_SIZE/2),this.ctx.lineTo(t,this.canvas.height-this.CELL_SIZE/2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.CELL_SIZE/2,t),this.ctx.lineTo(this.canvas.width-this.CELL_SIZE/2,t),this.ctx.stroke()}}drawTerritoryOverlay(){for(let a=0;a<this.BOARD_SIZE;a++)for(let e=0;e<this.BOARD_SIZE;e++){const t=this.gameState.territoryMap[a][e];if(t&&t!=="neutral"){const s=(e+.5)*this.CELL_SIZE,i=(a+.5)*this.CELL_SIZE;this.ctx.globalAlpha=.25,this.ctx.beginPath(),this.ctx.arc(s,i,6,0,2*Math.PI),this.ctx.fillStyle=t==="black"?"#000":"#fff",this.ctx.fill(),this.ctx.globalAlpha=1}}}drawStones(){const a=performance.now(),e=300;for(let t=0;t<this.BOARD_SIZE;t++)for(let s=0;s<this.BOARD_SIZE;s++){const i=this.gameState.board[t][s];if(!i)continue;const o=(s+.5)*this.CELL_SIZE,c=(t+.5)*this.CELL_SIZE;this.ctx.beginPath(),this.ctx.arc(o,c,this.STONE_RADIUS,0,2*Math.PI),this.ctx.fillStyle=i==="black"?"#000":"#fff",this.ctx.fill()}this.gameState.captureAnimations=this.gameState.captureAnimations.filter(t=>{var h;const s=a-t.startTime;if(s>e)return!1;const i=s/e,o=(t.col+.5)*this.CELL_SIZE,c=(t.row+.5)*this.CELL_SIZE,n=1-i,r=this.STONE_RADIUS*(1+i*.5);(h=this.gameState.board[t.row])==null||h[t.col];const d=this.gameState.capturedStones.black>this.gameState.capturedStones.white?"#000":"#fff";return this.ctx.globalAlpha=n,this.ctx.beginPath(),this.ctx.arc(o,c,r,0,2*Math.PI),this.ctx.fillStyle=d,this.ctx.fill(),this.ctx.globalAlpha=1,!0})}updateUI(){const a=document.getElementById("currentPlayer"),e=document.getElementById("moveCount");a&&(a.textContent=this.gameState.currentPlayer==="black"?"Black":"White"),e&&(e.textContent=this.gameState.moveCount.toString());const t=document.getElementById("blackCaptured"),s=document.getElementById("whiteCaptured"),i=document.getElementById("blackTerritory"),o=document.getElementById("whiteTerritory"),c=document.getElementById("blackTotal"),n=document.getElementById("whiteTotal");t&&(t.textContent=this.gameState.capturedStones.black.toString()),s&&(s.textContent=this.gameState.capturedStones.white.toString()),i&&(i.textContent=this.gameState.territoryScore.black.toString()),o&&(o.textContent=this.gameState.territoryScore.white.toString());const r=this.gameState.totalScore.black+this.gameState.territoryScore.black,l=this.gameState.totalScore.white+this.gameState.territoryScore.white;c&&(c.textContent=r.toString()),n&&(n.textContent=l.toString())}playSound(a){const e=this.audioCtx.createOscillator(),t=this.audioCtx.createGain();e.type="sine",e.frequency.value=a,t.gain.setValueAtTime(.05,this.audioCtx.currentTime),e.connect(t).connect(this.audioCtx.destination),e.start(),e.stop(this.audioCtx.currentTime+.1)}}const b="http://127.0.0.1:8010";function v(u){return g(this,null,function*(){yield fetch(`${b}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u})})})}function C(u,a,e,t){return g(this,null,function*(){yield fetch(`${b}/games`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({player1:u,player2:a,score_p1:e,score_p2:t})})})}function k(){return g(this,null,function*(){var s;const e=(yield(yield fetch(`${b}/leaderboard`)).json()).filter(i=>i.wins>0&&!["Player 1","Player 2","TestPlayer","Default","test"].includes(i.name)).sort((i,o)=>o.wins-i.wins).slice(0,10),t=document.getElementById("leaderboard");t&&(t.innerHTML=`
    <h3>üèÜ Leaderboard (Top 10)</h3>
    <table>
      <tr><th>Player</th><th>Wins</th></tr>
      ${e.map(i=>`<tr><td>${i.name}</td><td>${i.wins}</td></tr>`).join("")}
    </table>
    <button id="viewFullLeaderboard" class="btn btn-secondary" style="margin-top:8px;">
      View Full Leaderboard
    </button>
  `,(s=document.getElementById("viewFullLeaderboard"))==null||s.addEventListener("click",()=>P()))})}function P(){return g(this,null,function*(){var s;const e=(yield(yield fetch(`${b}/leaderboard`)).json()).filter(i=>!["Player 1","Player 2","TestPlayer","Default","test"].includes(i.name)).sort((i,o)=>o.wins-i.wins);let t=document.getElementById("leaderboardModal");t||(t=document.createElement("div"),t.id="leaderboardModal",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgba(0,0,0,0.6)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999",t.innerHTML=`
      <div style="
        background: #f8f5ef;
        padding: 20px;
        border-radius: 12px;
        width: 350px;
        max-height: 500px;
        overflow-y: auto;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      ">
        <h2 style="text-align:center;">üèÜ Full Leaderboard</h2>
        <table style="width:100%; border-collapse:collapse;">
          <tr style="background:#e0d5c0;"><th>Player</th><th>Wins</th></tr>
          ${e.map(i=>`<tr><td style="padding:6px;">${i.name}</td><td style="text-align:right;">${i.wins}</td></tr>`).join("")}
        </table>
        <div style="text-align:center; margin-top:12px;">
          <button id="closeLeaderboardModal" class="btn btn-primary">Close</button>
        </div>
      </div>
    `,document.body.appendChild(t)),(s=document.getElementById("closeLeaderboardModal"))==null||s.addEventListener("click",()=>t==null?void 0:t.remove())})}document.addEventListener("DOMContentLoaded",()=>new B);
